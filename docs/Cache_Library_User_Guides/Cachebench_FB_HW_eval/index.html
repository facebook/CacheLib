<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CacheLib RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CacheLib Atom Feed"><title data-react-helmet="true">Evaluating SSD hardware for Facebook workloads | CacheLib</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" name="twitter:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" property="og:url" content="https://cachelib.org/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Evaluating SSD hardware for Facebook workloads | CacheLib"><meta data-react-helmet="true" name="description" content="CacheBench is a cache benchmark tool used to stress the storage and"><meta data-react-helmet="true" property="og:description" content="CacheBench is a cache benchmark tool used to stress the storage and"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cachelib.org/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.619b363d.css">
<link rel="preload" href="/assets/js/runtime~main.739f5b09.js" as="script">
<link rel="preload" href="/assets/js/main.14bd59ac.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">CacheLib</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/">Build and Installation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">API and Usage</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a><a class="navbar__item navbar__link" href="/learnmore">Architecture Guide</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/learnmore/">Learn More</a><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cache_Library_User_Guides/Configuring_cachebench_parameters">Configuring cachebench parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cache_Library_User_Guides/Developing_for_Cachebench">Contributing to Cachebench</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval">Evaluating SSD hardware for Facebook workloads</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Evaluating SSD hardware for Facebook workloads</h1></header><p><code>CacheBench</code> is a cache benchmark tool used to stress the storage and
memory subsystem in a comparable way that they are stressed
in production workloads. This doc describes how Facebook leverages CacheBench
to validate SSD performance.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="system-requirements">System requirements<a class="hash-link" href="#system-requirements" title="Direct link to heading">â€‹</a></h2><p>To run CacheBench, first ensure that the machine has
sufficient free memory (50+GB) and SSD capacity (1TB).</p><ul><li>Memory: 64GB or more</li><li>SSD Capacity: 100GB or more available capacity</li><li>Internet connection capable of accessing github.com and installing packages</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="set-up-the-ssd-devices-using-mdraid">Set up the SSD devices using mdraid<a class="hash-link" href="#set-up-the-ssd-devices-using-mdraid" title="Direct link to heading">â€‹</a></h2><p>To gather SSD performance metrics, the SSD must be setup first. An example
below sets up a raid device to handle two ssds being used by CacheBench.</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">mdadm --create /dev/md0 --force --raid-devices=2 --level=0 --chunk=256 /dev/nvme1n1 /dev/nvme2n1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="installing-cachebench">Installing cachebench<a class="hash-link" href="#installing-cachebench" title="Direct link to heading">â€‹</a></h2><ol><li><p>If you have not already, clone the cachelib repository from github.com:</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/facebook/CacheLib.git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Build cachelib and <code>cachebench</code>:</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd CacheLib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./contrib/build.sh -j</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Notes:</p><ul><li>It will take several minutes to build and install all dependencies.</li><li>Remove <code>-j</code> flag to build using only a single CPU (build will take longer)</li><li>The script will automatically use <code>sudo</code> to install several OS packages (using <code>apt</code>, <code>dnf</code>, etc.)</li><li>The build script has been tested to work on stable Debian, Ubuntu, CentOS, RockyLinux.
Other systems are possible but not officially supported.</li></ul></li><li><p>The resulting binaries and libraries will be in <code>./opt/cachelib</code>:</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./opt/cachelib/bin/cachebench --help</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>or</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd ./opt/cachelib/bin/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./cachebench --help</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li><p>Sample test configurations are provided in <code>./opt/cachelib/test_configs/</code>.
Example:</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd ./opt/cachelib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./bin/cachebench --json_test_config ./test_configs/simple_test.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol><details class="details_Q743 alert alert--info details_h+cY" data-collapsed="true"><summary>Expected Output of test run</summary><div><div class="collapsibleContent_K5uX"><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd ./opt/cachelib</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./bin/cachebench --json_test_config ./test_configs/simple_test.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">===JSON Config===</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// @nolint instantiates a small cache and runs a quick run of basic operations.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;cache_config&quot; : {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;cacheSizeMB&quot; : 512,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;poolRebalanceIntervalSec&quot; : 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;moveOnSlabRelease&quot; : false,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;numPools&quot; : 2,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;poolSizes&quot; : [0.3, 0.7]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;test_config&quot; : {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;numOps&quot; : 100000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;numThreads&quot; : 32,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;numKeys&quot; : 1000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;keySizeRange&quot; : [1, 8, 64],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;keySizeRangeProbability&quot; : [0.3, 0.7],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;valSizeRange&quot; : [1, 32, 10240, 409200],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;valSizeRangeProbability&quot; : [0.1, 0.2, 0.7],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;getRatio&quot; : 0.15,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;setRatio&quot; : 0.8,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;delRatio&quot; : 0.05,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;keyPoolDistribution&quot;: [0.4, 0.6],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;opPoolDistribution&quot; : [0.5, 0.5]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Welcome to OSS version of cachebench</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Created 897,355 keys in 0.00 mins</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating 1.60M sampled accesses</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generating 1.60M sampled accesses</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Generated access patterns in 0.00 mins</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total 3.20M ops to be run</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">12:07:12       0.00M ops completed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">== Test Results ==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">== Allocator Stats ==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Items in RAM  : 96,995</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Items in NVM  : 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Alloc Attempts: 2,559,176 Success: 100.00%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RAM Evictions : 2,163,672</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Cache Gets    : 480,592</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hit Ratio     :  10.97%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NVM Gets      :               0, Coalesced : 100.00%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NVM Puts      :               0, Success   :   0.00%, Clean   : 100.00%, AbortsFromDel   :        0, AbortsFromGet   :        0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NVM Evicts    :               0, Clean     : 100.00%, Unclean :       0, Double          :        0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NVM Deletes   :               0 Skipped Deletes: 100.00%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Released 21 slabs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Moves     : attempts:          0, success: 100.00%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Evictions : attempts:      3,040, success:  99.57%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">== Throughput for  ==</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total Ops : 3.20 million</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Total sets: 2,559,176</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">get       :    49,453/s, success   :  10.97%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set       :   263,344/s, success   : 100.00%</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">del       :    16,488/s, found     :  10.83%</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div></div></details><ol start="5"><li>If fio is not installed, build it with:<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/axboe/fio.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd fio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./configure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make install</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol><p>See <a href="/docs/installation/">build and installation</a> for further details.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="running-the-benchmark-for-ssd-perf-testing">Running the benchmark for SSD perf testing<a class="hash-link" href="#running-the-benchmark-for-ssd-perf-testing" title="Direct link to heading">â€‹</a></h2><p>Cachebench has three configs packaged for SSD validation. These are under <code>test_configs/ssd_perf/&lt;service-domain&gt;</code>. Currently, we have &quot;graph_cache_leader&quot;, &quot;kvcache_reg&quot;, and &quot;kvcache_wc&quot; which represent three distinct cache workloads from Facebook. Below, we show how the benchmarks can be run for two of these workloads. It is important to trim the ssds between the runs to ensure any interference is avoided.</p><ol><li>Change to the path where you previously copied cachebench to.<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd &lt;your path&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li>If <code>/dev/md0</code> is not being used, edit workload files appropiately.
Change all instances of <code>/dev/md0</code> to raw path of data SSD(s):<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi ./test_configs/ssd_perf/graph_cache_leader/config.json</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vi ./test_configs/ssd_perf/kvcache_l2_wc/config.json</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div> See <a href="/docs/Cache_Library_User_Guides/Configuring_cachebench_parameters#storage-filedevicedirectory-path-info">configuring storage path</a>  for more details on how to configure the storage path.</li><li>Before each benchmark run, fully trim the drive with fio:<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fio --name=trim --filename=/dev/md0 --rw=trim --bs=3G</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li>Execute social graph leader cache workload:<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./cachebench -json_test_config test_configs/ssd_perf/graph_cache_leader/config.json --progress_stats_file=/tmp/graph_cache_leader.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li>Fully trim the drive with fio again:<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fio --name=trim --filename=/dev/md0 --rw=trim --bs=3G</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li><li>Execute the <code>kvcache</code> workload:<div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./cachebench -json_test_config test_configs/ssd_perf/kvcache_l2_wc/config.json â€”progress_stats_file=/tmp/mc-l2-wc.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tuning-the-workload-and-cache-parameters">Tuning the workload and cache parameters<a class="hash-link" href="#tuning-the-workload-and-cache-parameters" title="Direct link to heading">â€‹</a></h2><p>For a full list of options that can be configured, see <a href="/docs/Cache_Library_User_Guides/Configuring_cachebench_parameters">configuring cachebench</a></p><ol><li><strong>Duration of Replay</strong> - To run cachebench operation for longer,
increase the <code>numOps</code> appropriately in the config file.</li><li><strong>Device Info</strong> - Device info is configured in the config file
using the <code>nvmCachePaths</code> option.  If you would rather use a
filesystem based cache, pass the appropriate path through
<code>nvmCachePaths</code>.  The benchmark will create a single file
under that path corresponding to the configured <code>nvmCacheSizeMB</code></li><li><strong>Watching Progress</strong> -  While the benchmark runs, you can monitor the
progress so far. The interval for progress update can be configured
using the <code>--progress</code> and specifying a duration in seconds.
If <code>--progress-stats-file</code> is also specified, on every progress
interval, <code>cachebench</code> would log the internal stats to the specified file.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="getting-the-results">Getting the Results<a class="hash-link" href="#getting-the-results" title="Direct link to heading">â€‹</a></h2><p>View results summary through the log file:</p><div class="codeBlockContainer_J+bg language-sh theme-code-block"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tail -n 50 /tmp/graph_cache_leader.log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tail -n 50 /tmp/mc-l2-wc.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="plotting-latency-stats">Plotting latency stats<a class="hash-link" href="#plotting-latency-stats" title="Direct link to heading">â€‹</a></h2><p>The stats output can be parsed to plot SSD latency information over time. To
do this, first ensure <code>gnuplot</code> is installed. For example, on CentOs:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> gnuplot</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then run this command to get the latency stats:</p><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./vizualize/extract_latency.sh /tmp/graph_cache_leader.log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./vizualize/extract_latency.sh /tmp/mc-l2-wc.log</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This should produce a tsv file for read latency, a tsv file for write latency, and the corresponding <code>png</code> files that have the graphs plotted.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Cache_Library_User_Guides/Cachebench_FB_HW_eval.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Cache_Library_User_Guides/Developing_for_Cachebench"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Contributing to Cachebench</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-requirements" class="table-of-contents__link toc-highlight">System requirements</a></li><li><a href="#set-up-the-ssd-devices-using-mdraid" class="table-of-contents__link toc-highlight">Set up the SSD devices using mdraid</a></li><li><a href="#installing-cachebench" class="table-of-contents__link toc-highlight">Installing cachebench</a></li><li><a href="#running-the-benchmark-for-ssd-perf-testing" class="table-of-contents__link toc-highlight">Running the benchmark for SSD perf testing</a></li><li><a href="#tuning-the-workload-and-cache-parameters" class="table-of-contents__link toc-highlight">Tuning the workload and cache parameters</a></li><li><a href="#getting-the-results" class="table-of-contents__link toc-highlight">Getting the Results</a></li><li><a href="#plotting-latency-stats" class="table-of-contents__link toc-highlight">Plotting latency stats</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Reach Us</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/cachelib/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook Developer Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.739f5b09.js"></script>
<script src="/assets/js/main.14bd59ac.js"></script>
</body>
</html>