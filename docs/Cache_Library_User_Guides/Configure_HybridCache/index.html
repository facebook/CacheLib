<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CacheLib RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CacheLib Atom Feed"><title data-react-helmet="true">Configure HybridCache | CacheLib</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" name="twitter:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-react-helmet="true" property="og:url" content="https://cachelib.org/docs/Cache_Library_User_Guides/Configure_HybridCache"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configure HybridCache | CacheLib"><meta data-react-helmet="true" name="description" content="Enabling hybrid cache"><meta data-react-helmet="true" property="og:description" content="Enabling hybrid cache"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cachelib.org/docs/Cache_Library_User_Guides/Configure_HybridCache"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/Cache_Library_User_Guides/Configure_HybridCache" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://cachelib.org/docs/Cache_Library_User_Guides/Configure_HybridCache" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7349f10e.css">
<link rel="preload" href="/assets/js/runtime~main.a8e6cb69.js" as="script">
<link rel="preload" href="/assets/js/main.74214826.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">CacheLib</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation/installation">Build and Installation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">API and Usage</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a><a class="navbar__item navbar__link" href="/learnmore">Architecture Guide</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/learnmore/">Learn More</a><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">CacheLib user guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting Started with Cache Library</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Cache memory management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Hybrid Cache</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cache_Library_User_Guides/HybridCache">HybridCache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Cache_Library_User_Guides/Configure_HybridCache">Configure HybridCache</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Advanced Features</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Reference</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configure HybridCache</h1></header><h2 class="anchor anchorWithStickyNavbar_31ik" id="enabling-hybrid-cache">Enabling hybrid cache<a aria-hidden="true" class="hash-link" href="#enabling-hybrid-cache" title="Direct link to heading">â€‹</a></h2><p>You can configure the Navy engine (flash cache engine when running in the HybridCache mode) through the NvmCache::Config::navyConfig in the Cache config by using APIs provided in navy::NavyConfig, for example:</p><details class="details_2Ziz alert alert--info details_1VDD" data-collapsed="true"><summary> Simple hybrid cache setup </summary><div><div class="collapsibleContent_3OHp"> <div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;cachelib/allocator/CacheAllocator.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LruAllocator</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">Config lruConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LruAllocator</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">NvmCacheConfig nvmConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nvmConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setBlockSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4096</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nvmConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSimpleFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FLAGS_navy_file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   FLAGS_dipper_device_size_mb </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*fileSize*/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*truncateFile*/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nvmConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">blockCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRegionSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lruConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">enableNvmCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">nvmConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></details><p>All settings are optional, unless marked as <strong>&quot;Required&quot;</strong>. The default value is shown after the equal sign <code>=</code>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="basic-configuration">Basic configuration<a aria-hidden="true" class="hash-link" href="#basic-configuration" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="device">Device<a aria-hidden="true" class="hash-link" href="#device" title="Direct link to heading">â€‹</a></h3><ul><li><p>(<strong>Required</strong>) Set a simple file or RAID files</p><ul><li><p>simple file:</p><ul><li>(<strong>Required</strong>)<code>file name</code>
File/device path with cache.</li><li>(<strong>Required</strong>) <code>file size</code>
Size (in bytes) of the file/device with cache.</li><li><code>truncate file = false</code>
Default is <code>false</code>. If it is <code>true</code>, do <code>ftruncate</code> on the file to the requested size.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSimpleFile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fileName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fileSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> truncateFile </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*optional*/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>RAID files:</p><ul><li>(<strong>Required</strong>) <code>RAID paths</code>
Multiple files/devices to be used as a single cache. Note they must be identical in size.</li><li>(<strong>Required</strong>) <code>file size</code>
Size (in bytes) of a single file/device.</li><li><code>truncate file = false</code>
Default is <code>false</code>. If it is <code>true</code>, do <code>ftruncate</code> on the file to the requested size.</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRaidFiles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">raidPaths</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fileSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> truncateFile </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*optional*/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><ul><li><p><code>block size = 4096</code>
Device block size in bytes (minimum IO granularity).</p></li><li><p><code>device metadata size = 0</code>
The size of the metadata partition on the Navy device.</p></li><li><p><code>device max write size = 1024*1024</code>
This controls whatâ€™s the biggest IO we can write to a device. After it is configured, any IO size above it will be split and issued sequentially.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setBlockSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">blockSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setDeviceMetadataSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">deviceMetadataSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setDeviceMaxWriteSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">deviceMaxWriteSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="job-scheduler">Job scheduler<a aria-hidden="true" class="hash-link" href="#job-scheduler" title="Direct link to heading">â€‹</a></h3><ul><li><p>(<strong>Required</strong>) <code>reader threads = 32</code>
Number of threads available for processing <em>read</em> requests.</p></li><li><p>(<strong>Required</strong>) <code>writer threads = 32</code>
Number of threads available for processing <em>write</em> requests and navy-internal operations.</p></li></ul><ul><li><code>request ordering shards = 20</code>
If it is non-zero, we will enable request ordering where we put requests into 2<sup>N</sup> shards and ensure each shard executes requests in order.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setReaderAndWriterThreads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">readerThreads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> writerThreads</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setNavyReqOrderingShards</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">navyReqOrderingShards</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="other">Other<a aria-hidden="true" class="hash-link" href="#other" title="Direct link to heading">â€‹</a></h3><ul><li><code>max concurrent inserts = 1&#x27;000&#x27;000</code>
This controls how many insertions can happen in parallel. This is an effective way to avoid too many insertions backing up that drives  up the write latency (it can happen if the use case is too heavy on writes).</li><li><code>max parcel memory = 256 (MB)</code>
Total memory limit for in-flight parcels. Once this is reached, requests will be rejected until the parcel memory usage gets under the limit.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setMaxConcurrentInserts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">maxConcurrentInserts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setMaxParcelMemoryMB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">maxParcelMemoryMB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="navy-engine-specific-configuration">Navy engine specific configuration<a aria-hidden="true" class="hash-link" href="#navy-engine-specific-configuration" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_31ik" id="large-object-cache-blockcache">Large object cache (BlockCache)<a aria-hidden="true" class="hash-link" href="#large-object-cache-blockcache" title="Direct link to heading">â€‹</a></h3><p>These configuration control the behavior of the storage engine that caches
large objects</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="eviction-policy-choose-one-of-the-followings">Eviction policy (choose one of the followings):<a aria-hidden="true" class="hash-link" href="#eviction-policy-choose-one-of-the-followings" title="Direct link to heading">â€‹</a></h4><ul><li><p>LRU: default policy</p></li><li><p>FIFO: once enabled, LRU will be disabled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">enableFifo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><ul><li><p>segmented FIFO: once enabled, LRU and FIFO will be disabled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// sFifoSegmentRatio maps to segments in the order from least-important to most-important.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  e.g. {1, 1, 1} gives equal share in each of the 3 segments;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//       {1, 2, 3} gives the 1/6th of the items in the first segment (P0 least important),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//       2/6th of the items in the second segment(P1),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//      and finally 3/6th of the items in the third segment (P2).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">enableSegmentedFifo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sFifoSegmentRatio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="reinsertion-policy-choose-one-of-the-followings">Reinsertion policy (choose one of the followings):<a aria-hidden="true" class="hash-link" href="#reinsertion-policy-choose-one-of-the-followings" title="Direct link to heading">â€‹</a></h4><ul><li><p>hits based
If this is enabled, we will reinsert item that had been accessed more than the threshold since the last time it was written into block cache. This can better approximate a LRU than the region-based LRU. Typically users configure this with a region-granularity FIFO policy, or SFIFO policy.  It cannot be enabled when percentage based reinsertion policy has been enabled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">enableHitsBasedReinsertion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hitsThreshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><ul><li><p>percentage based
This is used for testing where a certain fraction of evicted items(governed by the percentage) are always reinserted.The percentage value is between 0 and 100 for reinsertion. It cannot be enabled when hits based reinsertion policy has been enabled.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">enablePctBasedReinsertion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pctThreshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_31ik" id="configuring-the-write-mode">Configuring the write mode<a aria-hidden="true" class="hash-link" href="#configuring-the-write-mode" title="Direct link to heading">â€‹</a></h4><ul><li><p><code>clean regions = 1</code>
How many regions do we reserve for future writes. Set this to be equivalent to your per-second write rate. It should ensure your writes will not have to retry to wait for a region reclamation to finish.</p></li><li><p><code>in-memory buffers = 0</code>
A non-zero value enables in-mem buffering for writes. All writes will first go into a region-sized buffer. Once the buffer is full, we will flush the region to the device. This allows BlockCache to internally pack items closer to each other (saves space) and also improves device read latency (regular sized write IOs means better read performance).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Clean Regions and in-mem buffer will be set together.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Once in-mem buffer is enabled, it is 2 * clean regions.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">setCleanRegions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cleanRegions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* enable in-mem buffers*/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><ul><li><p><code>size classes = []</code>
A vector of Navy BlockCache size classes (must be multiples of block size). If enabled, Navy will configure regions to allocate rounded up to these size classes and evict regions within a size classs. A given region allocates corresponding to a given size class. By default, objects will be stack allocated irrespective of their size on available regions.</p></li><li><p><code>region size = 16777216</code> (16 Mb)
Region size in bytes.</p></li><li><p><code>data checksum = true</code>
This controls whether or not BlockCache will verify the itemâ€™s value is correct (equivalent to its checksum). This should always be enabled, unless youâ€™re doing your own checksum logic at a higher layer.</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">blockCache</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">enableSegmentedFifo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sFifoSegmentRatio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">enableHitsBasedReinsertion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">hitsThreshold</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setCleanRegions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cleanRegions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">useSizeClasses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sizeClasses</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setRegionSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">regionSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setDataChecksum</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="small-object-cache-bighash">Small object cache (BigHash)<a aria-hidden="true" class="hash-link" href="#small-object-cache-bighash" title="Direct link to heading">â€‹</a></h3><ul><li><p>(<strong>Required</strong>) <code>size percentage</code>
Percentage of space to reserve for BigHash. Set the percentage &gt; 0 to enable BigHash. The remaining part is for BlockCache. The value has to be in the range of <!-- -->[0, 100]<!-- -->. Default value is 0.</p></li><li><p>(<strong>Required</strong>) <code>small item max size</code> (bytes)
Maximum size of a small item to be stored in BigHash. Must be less than the bucket size.</p></li><li><p><code>bucket size = 4096</code> (bytes)
Bucket size in bytes.</p></li><li><p><code>bucket bloom filter size = 8</code>
Bloom filter, bytes per bucket. Must be power of two. 0 means bloom filter will not be applied</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">bigHash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setSizePctAndMaxItemSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bigHashSizePct</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> bigHashSmallItemMaxSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setBucketSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bigHashBucketSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setBucketBfSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bigHashBucketBfSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><code>NavyConfig</code> provides a public function NavyConfig::serialize() so that you can call it to print out the data, e.g.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">XLOG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Using the following navy config&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> folly</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">toPrettyJson</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       folly</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">toDynamic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">serialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></blockquote><h2 class="anchor anchorWithStickyNavbar_31ik" id="admission-policy">Admission policy<a aria-hidden="true" class="hash-link" href="#admission-policy" title="Direct link to heading">â€‹</a></h2><p>HybridCache can leverage an admission policy to control burn rate of the underlying nvm devices (e.g. SSD drives). Using a suitable admission policy for your workloads can often not only improve device longevitiy but also improve the cache hit rate. You can configure an admission policy like the following example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> policy </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">make_shared</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cachelib</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">RejectFirstAP</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">LruAllocator</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* ... */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cacheConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setNvmCacheAdmissionPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">move</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuring-probabilistic-admission-policy">Configuring probabilistic admission policy<a aria-hidden="true" class="hash-link" href="#configuring-probabilistic-admission-policy" title="Direct link to heading">â€‹</a></h3><p>There are 2 types general purpose admission policy: &quot;random&quot; and &quot;dynamic_random&quot; to use probabilistic admission. Users can choose one of them to enable.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="random-policy">Random policy<a aria-hidden="true" class="hash-link" href="#random-policy" title="Direct link to heading">â€‹</a></h4><p>This policy just rejects <code>P%</code> of inserts, picking victims randomly. It lets user to reduce IOPS (and so increase flash life time).</p><ul><li><p>(<strong>Required</strong>) <code>admission probability</code>
Acceptance probability. The value has to be in the range of <!-- -->[0, 1]<!-- -->.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><pre tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">navyConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">enableRandomAdmPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setAdmProbability</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">admissionProbability</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#### Dynamic Random policy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  (**Required**) `admission write rate` (bytes/s)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Average **per day** write rate to target. Default to be 0 if not being  explicitly set, meaning no rate limiting.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">* `max write rate = 0` (bytes/s)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The max write rate to device in bytes/s to stay within the device limit of saturation to avoid latency increase. This ensures writing at any given second doesn&#x27;t exceed this limit despite a possibility of writing more to stay within the target rate above.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">*  `admission suffix length = 0`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Length of suffix in key to be ignored when hashing for probability.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *  `admission base size = 0`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> Navy item base size of baseProbability calculation. Set this closer to the mean size of objects. The probability is scaled for other sizes by using this size as the pivot.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ```cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> navyConfig.enableDynamicRandomAdmPolicy()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           .setAdmissionWriteRate(admissionWriteRate)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           .setMaxWriteRate(maxWriteRate)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           .setAdmissionSuffixLength(admissionSuffixLen)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           .setAdmissionProbBaseSize(admissionProbBaseSize);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="configuring-reject-first-policy">Configuring reject first policy<a aria-hidden="true" class="hash-link" href="#configuring-reject-first-policy" title="Direct link to heading">â€‹</a></h3><p>This policy helps if flash cache contains lots of inserted and never accessed items. It maintains a running window (sketch) of keys that were accessed. If a key is inserted for the first time, the policy rejects it. Second inserts get into the cache. A sketch consists of several splits. As times goes, old splits are discarded. With larger split, rejection gets more accurate (less false accepts).</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="dynamic-reject-or-rate-throttle">Dynamic reject (or rate throttle)<a aria-hidden="true" class="hash-link" href="#dynamic-reject-or-rate-throttle" title="Direct link to heading">â€‹</a></h3><p>This is a smart random reject policy. Users specify the maximum size of data that can be written to the device per day. Policy monitors <em>write</em> traffic and as it grows beyond the target (how much can be written up to this time of the day) it starts randomly reject inserts. It prefers to reject larger items to make hit ratio better. This behavior is tunable to allow users to control flash&#x27;s wearing out.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="machine-learning-based-admission-policy">Machine learning based admission policy<a aria-hidden="true" class="hash-link" href="#machine-learning-based-admission-policy" title="Direct link to heading">â€‹</a></h3><p>CacheLib also supports using ML based admission policy to make intelligent decision on what to admit into nvm devices. However, the use of ML policy requires careful analysis of cache workloads, and set up a training pipeline to train the model on a conintuous basis. Please try out the other admission policies first, and if you&#x27;re not satisfied with them, then reach out directly to the CacheLib team to discuss using a ML-based policy.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Cache_Library_User_Guides/Configure_HybridCache.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Cache_Library_User_Guides/HybridCache"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->HybridCache</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Cache_Library_User_Guides/chained_items"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Chained items<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enabling-hybrid-cache" class="table-of-contents__link toc-highlight">Enabling hybrid cache</a></li><li><a href="#basic-configuration" class="table-of-contents__link toc-highlight">Basic configuration</a><ul><li><a href="#device" class="table-of-contents__link toc-highlight">Device</a></li><li><a href="#job-scheduler" class="table-of-contents__link toc-highlight">Job scheduler</a></li><li><a href="#other" class="table-of-contents__link toc-highlight">Other</a></li></ul></li><li><a href="#navy-engine-specific-configuration" class="table-of-contents__link toc-highlight">Navy engine specific configuration</a><ul><li><a href="#large-object-cache-blockcache" class="table-of-contents__link toc-highlight">Large object cache (BlockCache)</a></li><li><a href="#small-object-cache-bighash" class="table-of-contents__link toc-highlight">Small object cache (BigHash)</a></li></ul></li><li><a href="#admission-policy" class="table-of-contents__link toc-highlight">Admission policy</a><ul><li><a href="#configuring-probabilistic-admission-policy" class="table-of-contents__link toc-highlight">Configuring probabilistic admission policy</a></li><li><a href="#configuring-reject-first-policy" class="table-of-contents__link toc-highlight">Configuring reject first policy</a></li><li><a href="#dynamic-reject-or-rate-throttle" class="table-of-contents__link toc-highlight">Dynamic reject (or rate throttle)</a></li><li><a href="#machine-learning-based-admission-policy" class="table-of-contents__link toc-highlight">Machine learning based admission policy</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Reach Us</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://www.facebook.com/cachelib/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Facebook Developer Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/FBOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a8e6cb69.js"></script>
<script src="/assets/js/main.74214826.js"></script>
</body>
</html>