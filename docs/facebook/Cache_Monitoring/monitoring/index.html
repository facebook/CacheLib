<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-facebook/Cache_Monitoring/monitoring">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Monitoring cache health | CacheLib</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-rh="true" name="twitter:image" content="https://cachelib.org/img/CacheLib-Logo-small.png"><meta data-rh="true" property="og:url" content="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Monitoring cache health | CacheLib"><meta data-rh="true" name="description" content="Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see Add monitoring for cache. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage."><meta data-rh="true" property="og:description" content="Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see Add monitoring for cache. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring"><link data-rh="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="https://cachelib.org/docs/facebook/Cache_Monitoring/monitoring" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CacheLib RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CacheLib Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="CacheLib" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.9576b86a.css">
<link rel="preload" href="/assets/js/runtime~main.c10705de.js" as="script">
<link rel="preload" href="/assets/js/main.a9e49b72.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/CacheLib-Logo-small.png" alt="My Facebook Project Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">CacheLib</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/installation">Build and Installation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">User Guide</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_User_Guides/Cachebench_Overview">Cachebench</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Cache_Library_Architecture_Guide/overview_a_random_walk">Architecture Guide</a><a class="navbar__item navbar__link" href="/">‌</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/learnmore/">Learn More</a><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Monitoring cache health</h1></header><p>Cachelib offers both ODS and Scuba monitoring for your cache health. To enable monitoring, see <a href="/docs/facebook/Cache_Monitoring/Add_monitoring_for_cache">Add monitoring for cache</a>. In Scuba and ODS, you can find such information as hit rate, rate of allocations, eviction age, fragmentation, etc. This comprehensive set of metrics helps you to know how well your cache is performing or to debug issues related to your cachelib usage.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-monitoring-dashboards">CacheLib Monitoring Dashboards<a class="hash-link" href="#cachelib-monitoring-dashboards" title="Direct link to heading">​</a></h2><p>In addition to building your own dashboard (and adding alarms), you can also use Cachelib&#x27;s dashboards for high level metrics on how your cache is doing. We offer two dashboards:</p><ol><li><strong><a href="https://fburl.com/unidash/ehpb743v" target="_blank" rel="noopener noreferrer">Main</a> - Most of the relevant cachelib metrics for our users</strong></li><li><strong><a href="https://fburl.com/unidash/5l3bbo4u" target="_blank" rel="noopener noreferrer">Allocation Class</a> - Deeper dive into cachelib&#x27;s ram cache behavior split by allocation classes</strong></li></ol><p>Please contact our oncall if you have a feature request or any ideas to improve these dashboards further.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ods">ODS<a class="hash-link" href="#ods" title="Direct link to heading">​</a></h2><p>Cachelib publishes ODS stats via <em>service data</em> (which exports to the fb303 port). If you already use Thrift, you should already get the fb303 port free. Otherwise, you need to open a fb303 port in your service. For cachelib stats to show up on ODS, you must set up a monitoring config that registers cachelib’s stats. </p><p>Please reach out to cachelib team on how to add cachelib into your existing monitoring config.</p><p>Cachelib ODS stats start with the prefix <code>cachelib.&lt;your_cache_name&gt;</code>. Many cachelib stats comes in the accumulative form. For example, <code>cachelib.&lt;your_cache_name&gt;.items.total</code> is the accumulative number of items in cache since your service has started. Other stats are offered in rate variants (for example, <code>cachelib.&lt;your_cache_name&gt;.cache.alloc_attempts.60</code>). If you think certain stats should be exported but are missing, reach out cachelib oncall for assistance.</p><p>The status is also broken down by pools. For example on DRAM cache size:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">usable_size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">advised_size</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To obtain break-down of advised memory per pool:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">usable_size</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cachelib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">cache</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">pool</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">name</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">advised_size</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use our <a href="https://fburl.com/unidash/7uqai4oc" target="_blank" rel="noopener noreferrer">ODS dashboard</a> to check key stats (you need to select the cacheName and enter the entity). For a complete list of cachelib ODS stats, see <a href="https://docs.google.com/spreadsheets/d/1udXP8uavr3wFjOhRoU9Eb_FI5IS8FDrPkz_O9LwNz0k/edit?usp=sharing" target="_blank" rel="noopener noreferrer">this sheet</a> and the <a href="https://fburl.com/code/84oidxl8" target="_blank" rel="noopener noreferrer">code pointer</a> that generate all cachelib ODS stats.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="scuba">Scuba<a class="hash-link" href="#scuba" title="Direct link to heading">​</a></h2><p>We have several Scuba tables, each servering a different purpose. They help you to triage different type of issues. We&#x27;ll describe the three most relevant tables first, covering other tables in <a href="https://www.internalfb.com/intern/wiki/Cache_Library_User_Guides/monitoring/#Misc_Scuba_tables_for_debugging" target="_blank" rel="noopener noreferrer">Misc_Scuba_tables_for_debugging</a>. If you find any stat missing in this list of tables, contact us and we&#x27;ll add them here. Note that all our counters, Scuba or ODS, are accumulative counters. They are not rate of change counters.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-admin-pool-stats">Cachelib Admin pool stats<a class="hash-link" href="#cachelib-admin-pool-stats" title="Direct link to heading">​</a></h3><p>This dataset gives you high level information on how well your cache is doing. On a per-pool basis, you can find the following information: How many allocs are happening? How many items are there in my cache? How much fragmentation am I seeing? What&#x27;s the rate of eviction? See the sample <a href="https://fburl.com/scuba/nwhc6gb8" target="_blank" rel="noopener noreferrer">Cachelib Admin Pool Stats</a>.</p><p>Note all stats applies to an individual memory pool. If you only have one pool, then this is basically the global cache stats. Otherwise, you need to sum the stats for each pool to get true global cache stats.</p><ol><li><strong>Active Allocs</strong>
Number of outstanding allocations (items).</li><li><strong>Alloc Attempts</strong>
How many times you have called the <code>allocate()</code> function for this pool.</li><li><strong>Alloc Failures</strong> How many times of the above resulted in a failure. The cause is usually no free memory. A high rate of this indicates the rate of allocation is too much and evictions cannot keep up.</li><li><strong>Evictable Items</strong> Number of evictable allocations (items). Please recall cachelib also lets you allocate non-evictable items. This number should be always be less than or equal to Active Allocs.</li><li><strong>Unevictable Items</strong> We let you allocate permanent items (items that will never be evicted). This is the number of those. Beware that if this number is high (i.e., more than a few percent of the unevictable items), you may see performance impacts (suboptimal hit-rate and longer amount of time to rebalance your cache).</li><li><strong>Evictions</strong> Number of evictions since cache started.</li><li><strong>Fragmentation Size</strong> How much fragmentation there is. If this figure is more than 10% of your total pool size, it means you should consider customizing your allocation sizes in this pool to fit your allocations better. We have had use cases where we cut their fragmentation down from 15% to 5%, effectively giving them 10% more memory for caching.</li><li><strong>Free Allocs</strong> Number of allocations that are freed. Usually if you have not configured your cache with TTL or have logic that explicitly invalidates cached items, you should not see a high number for this stat.</li><li><strong>Free Memory</strong> This is the total memory footprint from Free Allocs and Free Slabs.</li><li><strong>Free Slabs</strong> This indicates how many slabs in your pool that are not being used. You&#x27;re expected to see this number when your cache is still warming up. However, in steady state, you should expect 0 or (very close to 0) across your tier.</li><li><strong>Invalid Allocs</strong> How many allocations were rejected because you requested for an invalid size; that is, the size requested is too big. We have a hard ceiling of 4 MB for the entire item, which means (4 MB - 31 bytes) for your key and value. Also you can lower this ceiling yourself (but not increase it).</li><li><strong>Items</strong> This is the same as Active Allocs. It&#x27;s redundant.</li><li><strong>Pool Get Hits</strong> How many hits there have been in this pool since the cache started. Unfortunately we&#x27;re not able to give you a hit-rate because we do not know which pool the misses went. If you only have one pool, then divide this number by the total requests to cache to get the equivalent to hit rate.</li><li><strong>Pool Size</strong> Configured size of this pool. This does not indicate how big this pool really is at this moment. It means how big this pool can grow to be. In general, in steady state, you should expect the total slabs stat to match this.</li><li><strong>Total Slabs</strong> The number of slabs in this pool. Used and unused. This stat multiplied by 4MB should be equal to <em>Pool Size</em> in steady state.</li><li><strong>Unallocated Slabs</strong> Number of slabs not yet allocated from the slab allocator. You&#x27;re expected to see this number when your cache is still warming up. However, in steady state, you should expect 0 or (very close to 0) across your tier.</li><li><strong>Min/Max Eviction Age</strong> This is the minimum and maximum eviction age for the allocation classes in this pool. Cachelib uses a slab allocator so different alloc sizes may have different eviction age. In general, this tells you that if you insert an item into this pool and never read it, how long you can expect this item to stay cached. It is a good approximate for retention time.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-admin-ac-stats">Cachelib Admin Ac Stats<a class="hash-link" href="#cachelib-admin-ac-stats" title="Direct link to heading">​</a></h3><p>This is similar to <em>cachelib admin pool stats</em> but a more in-depth view at each allocation class. Cachelib uses a slab allocator underneath, so we divide memory inside each pool into a set of allocation sizes. Each allocation size is an allocation class. This table gives you the following information: How many items are in this allocation size? How much fragmentation is there? Rate of eviction? How many free allocations are available? What is the eviction age? See the sample <a href="https://fburl.com/scuba/1yhoxsuu" target="_blank" rel="noopener noreferrer">Cachelib Admin Ac Stats</a>.</p><p>All the stats here applies to an individual allocation class. For example, your cache may be configured to have only two allocation sizes: 80 bytes and 1 MB. This means all your allocations will either be allocated from 80 bytes (if what you request via <code>CacheAllocator::allocate()</code> is less than or equal to 80 bytes) or 1 MB. Anything above 1 MB will result in an exception (reflected in the number of Invalid Allocs in Pool Stats). You will see two sets of AC stats for your pool. One refers to the 80-byte class and the other refers to the 1 MB class.</p><ol><li><strong>Active Allocs</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Alloc Attempts</strong> Same as above.</li><li><strong>Alloc Failures</strong> Same as above.</li><li><strong>Alloc Size</strong> The allocation size for this class. This is the real allocation you get when you request for a size that is less than or equal to this allocation class&#x27;s size. For example, if you have two AC&#x27;s: 80 bytes and 100 bytes. And you request for 92 bytes. You will get an allocation that is actually 100 bytes and thus you have just incurred a fragmentation of 8 bytes.</li><li><strong>Evictable Items</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Eviction Age</strong> This is how long your item for this allocation class will be cached if you never access it again after insertion. Use this to get a sense of how long the cache retention time is for all of your objects that are of this allocation size.</li><li><strong>Evictions</strong> Number of evictions in this allocation class since cache started up.</li><li><strong>Fragmentation Size</strong> Total amount of fragmentation incurred in this allocation class.</li><li><strong>Free Allocs</strong> Same as Pool stats but only apply for this allocation class.</li><li><strong>Free Slabs</strong> Same as above.</li><li><strong>Full</strong> This allocation class is full, which means it has zero free slab. Eviction is the only way to obtain new allocations.</li><li><strong>Lru Refresh Time Evictable</strong> How often do we promote an item on read or write? This applies only to evictable items.</li><li><strong>Lru Refresh Time Unevictable</strong> Same as above. Only applies to unevictable items.</li><li><strong>Num Hits</strong> Number of cache hits that are from items in this allocation class.</li><li><strong>Total Free Memory</strong>: The total available memory for allocations.</li><li><strong>Total Used Bytes</strong> How many bytes are used for allocations (this includes all the fragmentation incurred by allocations).</li><li><strong>Unevictable Items</strong> Same as Pool Stats but only for this allocation class.</li><li><strong>Used Slabs</strong> How many slabs are used currently by this allocation class.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-admin-items-stats">Cachelib Admin Items stats<a class="hash-link" href="#cachelib-admin-items-stats" title="Direct link to heading">​</a></h3><p>This table  gives you information on individual items that can help you reason about the composition of the cache. The table is populated by picking a random item weighted by its size and uploading the  metadata for  this item. Overtime (several days to a few weeks), you can get a very good idea on what sort of items live in your cache. For example, if you&#x27;re running a service like Memcache, you may be interested in finding out what are the top key families that consume most of your cache memory (items that start with the same key prefix is one key family). Some of the other stats we offer is how long this item has been around in cache and how much fragmentation was introduced by allocating this item. See the sample <a href="https://fburl.com/scuba/pnxdevhe" target="_blank" rel="noopener noreferrer">Cachelib Admin Items Stats</a>.</p><p>The following columns are available for sampled items.</p><ol><li><strong>Item Age</strong>   - time since the creation of the item.</li><li><strong>Key Size</strong> - the size of the key for the item.</li><li><strong>Value Size</strong> - the allocation size requested for the item in bytes.</li><li><strong>Total Item Size</strong> - the size requested for key and the value and item metadata.</li><li><strong>Alloc Size</strong> - the size class the item was allocated to.</li><li><strong>Fragmenation Size</strong> - unused fragmentation size for the item.</li><li><strong>Class Id</strong> - class id corresponding to the allocation.</li><li><strong>Pool Id</strong> - pool id corresponding to the allocation.</li><li><strong>Creation Time</strong> - time when the item was created.</li><li><strong>Est Lifetime</strong> - the ttl which was used to allocate the item.</li><li><strong>Ttl</strong> - time remaining from the sampling point to actual expiry of the item.</li><li><strong>Expiry Time</strong> - time when the item</li><li><strong>Is Chained Item</strong> - if the item is a  chained allocation that belongs to a chain of allocations.</li><li><strong>Has Chained Item</strong> - if the item is the parent item and has chained allocations.</li><li><strong>Key</strong> - the key for the item in binary format</li><li><strong>Hex Key</strong> - the key represented in hexadecimal format.</li></ol><blockquote><p>❗ IMPORTANT:</p><p>The cachelib_admin_item_stats table contains senstive cache information in raw form (key/hex-key). Due to this, the access to the table is restricted to cachelib team. If this data would be useful to debugging for your team in a particular issue, you can request temporary access through the scuba workflow.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="misc-scuba-tables-for-debugging">Misc Scuba Tables for Debugging<a class="hash-link" href="#misc-scuba-tables-for-debugging" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-logs">Cachelib Logs<a class="hash-link" href="#cachelib-logs" title="Direct link to heading">​</a></h3><p>This table has all the logs cachelib internally writes (at a sampled rate). This can be useful for debugging. For example, suppose you notice one day that cachelib&#x27;s slab rebalancing is stuck on a few machines; you then filter for these hosts in this dataset, and you may find we&#x27;re logging some items are stuck in moving, which could then indicate a deadlock in the <code>movingSync</code> you supplied to us or point to an internal cachelib bug. You look at this table only when things are not working as expected.</p><p>Add the following to enable cachelib logging:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// In your program&#x27;s main.cpp:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> folly </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getBaseLoggingConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facebook</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">cachelib</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">registerCachelibScubaLogger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> CACHELIB_FOLLY_LOGGING_CONFIG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Alternatively, you can configure your own log levels.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  return &quot;cachelib=&lt;LOG_LEVEL&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//                 &quot;:&lt;LOG_HANDLER&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//                 &quot;;&lt;LOG_HANDLER&gt;=&lt;NAME_OF_LOG_HANDLER&gt;&quot;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//  e.g., &quot;cachelib=ERR:cachelib_scuba;cachelib_scuba=cachelib_scuba_logger&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// namespace folly</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To override the default folly logging level, pass in a command line option when starting your binary or set the option via Thrift fb303. Refer to the folly logging documentation for more information on log levels and categories.</p><div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Change log level on startup.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Changes the default logging level to &quot;WARN&quot;. By default cachelib logs everything at INFO.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;your_binary&gt; --logging &quot;WARN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Change log level during runtime.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Changes cachelib logging level to &quot;DBG&quot;. By default cachelib logs everything at INFO.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">buck build common/fb303/scripts:fb303_logging_config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">buck-out/gen/common/fb303/scripts/fb303_logging_config.par \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --host &lt;YOUR_HOST&gt;:&lt;YOUR_FB303_PORT&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --update &#x27;cachelib:=DBG&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-admin-metadata">Cachelib Admin Metadata<a class="hash-link" href="#cachelib-admin-metadata" title="Direct link to heading">​</a></h3><p>(<strong>Deprecated</strong>) This table has some basic information such as cache version, cache size, and cache name. When a service running cachelib first starts, it sends a sample to this table. In general, this is a good way to visualize what version every cachelib user is running on. It is <strong>deprecated</strong> in favor of <em>Cachelib Admin Allocator Config</em>. See the sample <a href="https://fburl.com/scuba/0daj3xn9" target="_blank" rel="noopener noreferrer">Cachelib Admin Metadata</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cachelib-admin-allocator-config">Cachelib Admin allocator config<a class="hash-link" href="#cachelib-admin-allocator-config" title="Direct link to heading">​</a></h3><p>This is intended to replace <em>Cachelib Admin Metadata</em>. It uploads everything the metadata table does and also uploads all the cache configurations. This will be very useful to check what config your service is running (when you&#x27;re rolling out a new change for example or debugging an on-going issue). For example, you can find out which host has slab rebalancing enabled or how big the hash table is configured for a particular tier.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/CacheLib/edit/main/website/docs/facebook/Cache_Monitoring/monitoring.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cachelib-monitoring-dashboards" class="table-of-contents__link toc-highlight">CacheLib Monitoring Dashboards</a></li><li><a href="#ods" class="table-of-contents__link toc-highlight">ODS</a></li><li><a href="#scuba" class="table-of-contents__link toc-highlight">Scuba</a><ul><li><a href="#cachelib-admin-pool-stats" class="table-of-contents__link toc-highlight">Cachelib Admin pool stats</a></li><li><a href="#cachelib-admin-ac-stats" class="table-of-contents__link toc-highlight">Cachelib Admin Ac Stats</a></li><li><a href="#cachelib-admin-items-stats" class="table-of-contents__link toc-highlight">Cachelib Admin Items stats</a></li></ul></li><li><a href="#misc-scuba-tables-for-debugging" class="table-of-contents__link toc-highlight">Misc Scuba Tables for Debugging</a><ul><li><a href="#cachelib-logs" class="table-of-contents__link toc-highlight">Cachelib Logs</a></li><li><a href="#cachelib-admin-metadata" class="table-of-contents__link toc-highlight">Cachelib Admin Metadata</a></li><li><a href="#cachelib-admin-allocator-config" class="table-of-contents__link toc-highlight">Cachelib Admin allocator config</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Reach Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/CacheLib" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.facebook.com/cachelib/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook Developer Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2025 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c10705de.js"></script>
<script src="/assets/js/main.a9e49b72.js"></script>
</body>
</html>