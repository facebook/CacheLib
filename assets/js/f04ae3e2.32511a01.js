"use strict";(self.webpackChunkcachelib=self.webpackChunkcachelib||[]).push([[6533],{15680:(e,a,t)=>{t.r(a),t.d(a,{MDXContext:()=>s,MDXProvider:()=>p,mdx:()=>f,useMDXComponents:()=>d,withMDXComponents:()=>m});var n=t(96540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(){return i=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},i.apply(this,arguments)}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function c(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),m=function(e){return function(a){var t=d(a.components);return n.createElement(e,i({},a,{components:t}))}},d=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=d(e.components);return n.createElement(s.Provider,{value:a},e.children)},h={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),m=d(t),p=r,u=m["".concat(o,".").concat(p)]||m[p]||h[p]||i;return t?n.createElement(u,l(l({ref:a},s),{},{components:t})):n.createElement(u,l({ref:a},s))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=u;var l={};for(var c in a)hasOwnProperty.call(a,c)&&(l[c]=a[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=t[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},41349:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>m,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var n=t(9668),r=t(21367),i=(t(96540),t(15680)),o=["components"],l={id:"Cachelib_onboarding_guide",title:"CacheLib Onboarding Guide"},c=void 0,s={unversionedId:"facebook/Cachelib_Developers/Cachelib_onboarding_guide",id:"facebook/Cachelib_Developers/Cachelib_onboarding_guide",title:"CacheLib Onboarding Guide",description:"Team Culture",source:"@site/docs/facebook/Cachelib_Developers/Cachelib_onboarding_guide.md",sourceDirName:"facebook/Cachelib_Developers",slug:"/facebook/Cachelib_Developers/Cachelib_onboarding_guide",permalink:"/docs/facebook/Cachelib_Developers/Cachelib_onboarding_guide",draft:!1,editUrl:"https://github.com/facebook/CacheLib/edit/main/website/docs/facebook/Cachelib_Developers/Cachelib_onboarding_guide.md",tags:[],version:"current",frontMatter:{id:"Cachelib_onboarding_guide",title:"CacheLib Onboarding Guide"}},m={},d=[{value:"Team Culture",id:"team-culture",level:2},{value:"Critical Bug Handling",id:"critical-bug-handling",level:3},{value:"Get Started",id:"get-started",level:2},{value:"SOURCE CODE",id:"source-code",level:3},{value:"UNIT TEST",id:"unit-test",level:3},{value:"CACHEBENCH \u2014 PERFORMANCE TEST",id:"cachebench--performance-test",level:3},{value:"COGWHEEL \u2014 CORRECTNESS TEST",id:"cogwheel--correctness-test",level:3},{value:"CANARY TEST",id:"canary-test",level:3},{value:"&quot;Shadow&quot; v.s. &quot;Canary&quot;.",id:"shadow-vs-canary",level:3},{value:"Oncall",id:"oncall",level:2},{value:"TIPS FOR NEW ONCALL:",id:"tips-for-new-oncall",level:3},{value:"CacheLib Knowledge",id:"cachelib-knowledge",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"DRAM (REGULAR ITEM)",id:"dram-regular-item",level:3},{value:"NVM (BIGHASH)",id:"nvm-bighash",level:3},{value:"NVM (BLOCKCACHE)",id:"nvm-blockcache",level:3}],p={toc:d};function h(e){var a=e.components,l=(0,r.A)(e,o);return(0,i.mdx)("wrapper",(0,n.A)({},p,l,{components:a,mdxType:"MDXLayout"}),(0,i.mdx)("h2",{id:"team-culture"},"Team Culture"),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"[work in progress]"),". Refer to ",(0,i.mdx)("a",{parentName:"p",href:"https://docs.google.com/document/d/1A8StkHeR53vOxB5UeA4DGyxcVsECdrNaXdOL_hsHrew/edit"},"CacheLib Team Work Agreement")),(0,i.mdx)("h3",{id:"critical-bug-handling"},"Critical Bug Handling"),(0,i.mdx)("p",null,"Since the CacheLib is used by hundreds of services, the bug in CacheLib could be more critical than as we can imagine. Also, it is known to be a wrong assumption that most of the critical bugs impacting customers should be detected by client services' release testings; there could be some bug (e.g., ",(0,i.mdx)("a",{parentName:"p",href:"https://internalfb.com/S378191"},"S378191"),") that is triggered only in either an untested corner cases or a special condition (e.g., peak load) whose detection might have been missed by CI (e.g., cogwheel)."),(0,i.mdx)("p",null,"So, once a bug is identified, we should do the careful assessment first. And if it is required to prevent any affected packages from being pushed to production, we should create ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Bad_Package_Detector/"},"BPD")," ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/sf/bad_package_detector/"},"here")," immediately even before the fix is available."),(0,i.mdx)("h2",{id:"get-started"},"Get Started"),(0,i.mdx)("p",null,"Read ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/staticdocs/cachelib/docs/"},"CacheLib User Guide")," to understand how cachelib is used by users."),(0,i.mdx)("p",null,"Cachelib has two levels of caches: DRAM and flash(",(0,i.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Non-volatile_memory"},"NVM"),"). Each of them is further divided into two types of caches for items smaller or larger than a certain threshold."),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"The cache for small items in DRAM is ",(0,i.mdx)("strong",{parentName:"li"},"CompactCache"),'. (Note: CompactCache is in "maintenance mode" for now)'),(0,i.mdx)("li",{parentName:"ul"},"The cache for large/regular items in DRAM \u2014 it doesn\u2019t have a name!"),(0,i.mdx)("li",{parentName:"ul"},"The cache for small items in flash is called ",(0,i.mdx)("strong",{parentName:"li"},"BigHash"),"."),(0,i.mdx)("li",{parentName:"ul"},"The cache for large items in flash is called ",(0,i.mdx)("strong",{parentName:"li"},"BlockCache"),".",(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},"BigHash + BlockCache is called Navy."),(0,i.mdx)("li",{parentName:"ul"},"The coordination layer between DRAM cache and Navy is NvmCache.\n",(0,i.mdx)("img",{src:t(35220).A,width:"820",height:"428"}))))),(0,i.mdx)("h3",{id:"source-code"},"SOURCE CODE"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"fbclone fbsource\nhttps://www.internalfb.com/intern/diffusion/FBS/browsedir/master/fbcode/cachelib/allocator\n")),(0,i.mdx)("p",null,"Major components:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"DRAM: ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/allocator/CacheAllocator.h"},"CacheAllocator"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/allocator/memory/MemoryAllocator.h"},"MemoryAllocator"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/allocator/CacheItem.h"},"Item"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/allocator/Handle.h"},"ItemHandle")),(0,i.mdx)("li",{parentName:"ul"},"NVM: ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/allocator/nvmcache/NvmCache.h"},"NvmCache"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/navy/driver/Driver.h"},"Navy Driver"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/navy/bighash/BigHash.h"},"BigHash Engine"),", ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/navy/block_cache/BlockCache.h"},"Block Cache Engine")),(0,i.mdx)("li",{parentName:"ul"},"Admin: ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/facebook/admin/CacheAdmin.h"},"CacheAdmin")),(0,i.mdx)("li",{parentName:"ul"},"ML: ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/code/fbsource/fbcode/cachelib/facebook/ml_admission/lightgbm/models/"},"ML admission models"))),(0,i.mdx)("p",null,"IDE: using ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Vscode/Languages/Cpp/"},"VSCode")," to navigate code, if navigation doesn\u2019t work try to restart vscode, restart devserver, or alloc a new devserver. A good tool if you use tmux and iterm2: ",(0,i.mdx)("a",{parentName:"p",href:"https://fburl.com/wiki/rd80tf81"},"https://fburl.com/wiki/rd80tf81")),(0,i.mdx)("h3",{id:"unit-test"},"UNIT TEST"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"https://fburl.com/diffusion/j6lky5rc"},"https://fburl.com/diffusion/j6lky5rc")),(0,i.mdx)("p",null,"Build and run:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"buck test cachelib/allocator/tests:cache-allocator-test -- <test name>\n")),(0,i.mdx)("p",null,"For example:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"buck test cachelib/allocator/tests:cache-allocator-test -- BaseAllocatorTest/1.RebalanceWakeupAfterAllocFailure # (\u201c/1\u201d means different test input)\nbuck test cachelib/facebook/ml_admission/lightgbm/models/tao/tests:tao_ml_admission_test\nbuck test cachelib/facebook/ml_admission/lightgbm/models/warmstorage/tests:ap-test\n")),(0,i.mdx)("p",null,"Find the TARGETS file for the test file, and look for the target name in TARGETS, then"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"buck test path/related/to/fbcode:target_name\n")),(0,i.mdx)("p",null,"This will run all test in the test file, add ",(0,i.mdx)("inlineCode",{parentName:"p"},"-- TestName.FunctionName")," to run a single test case in the file."),(0,i.mdx)("p",null,"To run the test binary (debug purpose):"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"buck-out/dev/gen/cachelib/allocator/tests/cache-allocator-test --gtest_filter=<test name>\n")),(0,i.mdx)("p",null,"A introduction to ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.ibm.com/articles/au-googletestingframework/"},"google test"),"."),(0,i.mdx)("h3",{id:"cachebench--performance-test"},"CACHEBENCH \u2014 PERFORMANCE TEST"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"../../Cache_Library_User_Guides/Cachebench_Overview"},"Cachebench Overview")),(0,i.mdx)("p",null,"Examples given in the above doc is for ",(0,i.mdx)("a",{parentName:"p",href:"https://internalfb.com/T10"},"T10")," machine (a production server, ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Facebook_Server_SKUs/"},"details"),"), following examples can be tried in dev server (it may take more than a hour to finish):"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"./cachebench --json_test_config test_configs/consistency/navy.json \u2014progress_stats_file=/tmp/navy.log\n")),(0,i.mdx)("h3",{id:"cogwheel--correctness-test"},"COGWHEEL \u2014 CORRECTNESS TEST"),(0,i.mdx)("p",null,"CogWheel is a python wrapper of CacheBench for correctness test. This test is run when code is committed to cachelib."),(0,i.mdx)("p",null,"Examples:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre"},"buck run //cachelib/facebook/cogwheel:cogwheel_cachelib_consistency_navy_with_deletes_with_truncated_alloc_size-launcher -- --build-fbpkg --run-disabled --tests cachelib_cogwheel_test\n")),(0,i.mdx)("p",null,"Adding new test config under cachelib/cachebench/test_configs, then add a new target in ",(0,i.mdx)("a",{parentName:"p",href:"https://fburl.com/diffusion/ff7c4jhz"},"https://fburl.com/diffusion/ff7c4jhz")),(0,i.mdx)("p",null,"To write a new test config for cachebench, see ",(0,i.mdx)("a",{parentName:"p",href:"https://fburl.com/wiki/pxz0t4m5"},"https://fburl.com/wiki/pxz0t4m5")),(0,i.mdx)("h3",{id:"canary-test"},"CANARY TEST"),(0,i.mdx)("p",null,'The word \u201cCanary\u201c means "run your code on real machine so it receives traffic".'),(0,i.mdx)("p",null,"Depending on what tool you use, it's different command to run."),(0,i.mdx)("p",null,"For example, you are doing a configerator change, and you want to test this change somewhere (even on your own devserver), you need configerator canary: ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Configerator/User_Guide/Testing_Configs/Manual_Canary_Testing/"},"https://www.internalfb.com/intern/wiki/Configerator/User_Guide/Testing_Configs/Manual_Canary_Testing/")),(0,i.mdx)("p",null,"If you build a new package (fbpkg), and you want to run it in your production tier and your production tier is powered by tuppleware, you need tuppleware canary: ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Tupperware/CLI_References/tw_canary/"},"https://www.internalfb.com/intern/wiki/Tupperware/CLI_References/tw_canary/")),(0,i.mdx)("p",null,"It's also possible that your service is managed by ServiceFoundry, then you use sf canary ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Tupperware/Tupperware_Overview/canaries/"},"https://www.internalfb.com/intern/wiki/Tupperware/Tupperware_Overview/canaries/")),(0,i.mdx)("p",null,"WarmStorage uses sf. I think sf is just a wrapper on top of tuppleware so that it's more service owner oriented."),(0,i.mdx)("p",null,"Then it's also possible that your team built its own tool. For some core data service, we use Service Platform, which is an alternative to tuppleware made by Core Data. ",(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/wiki/Service_Platform/Operations"},"https://www.internalfb.com/intern/wiki/Service_Platform/Operations"),". When you do testing for TAO, you'd run something like svc-experiment tao start-shadow."),(0,i.mdx)("h3",{id:"shadow-vs-canary"},'"Shadow" v.s. "Canary".'),(0,i.mdx)("p",null,"Shadow means to run two sets of hosts, they run on different binary or configs, but receives the exact same traffic."),(0,i.mdx)("p",null,"Canary only means to put your binary/config to real tier. There is not an explicit comparison and more specifically, hosts on the same tier may not have the exact same traffic."),(0,i.mdx)("p",null,"So shadow is a more delicate testing. Amongst our clients, only TAO has an easy shadow setup (you just run one command). WarmStorage can have shadow, but that involves an engineer manually setting up a cluster and the cluster would have to have at least 20 hosts due to WS's business logic. So we don't really use shadow to test in WarmStorage."),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"../Working_Set_Analysis/WSA_logging_library/#canary-test"},"Here")," is an example to run canary test on WarmStorage."),(0,i.mdx)("h2",{id:"oncall"},"Oncall"),(0,i.mdx)("p",null,"Refer to ",(0,i.mdx)("a",{parentName:"p",href:"https://fb.quip.com/UaCHAuKT2v7I"},"CacheLib Oncall Rulebook")),(0,i.mdx)("h3",{id:"tips-for-new-oncall"},"TIPS FOR NEW ONCALL:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Oncall tasks will topically include the hostname or tuppleware job/task link where you can find the hostname."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"sush hostname")," can login the machine. If there was a crash, core dump is located at ",(0,i.mdx)("inlineCode",{parentName:"li"},"/var/tmp/cores"),"."),(0,i.mdx)("li",{parentName:"ul"},"bunnylol ",(0,i.mdx)("inlineCode",{parentName:"li"},"tw hostname/tw jobname/tw taskid")," in Chrome to go to the tuppleware page"),(0,i.mdx)("li",{parentName:"ul"},"To get the package binary, find the package revision in tupleware page, ",(0,i.mdx)("inlineCode",{parentName:"li"},"fbpkg.fetch revision")),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"machinechecker hostname")," to check host hardware healthy"),(0,i.mdx)("li",{parentName:"ul"},"Please paste any useful information in gdb to the task comment"),(0,i.mdx)("li",{parentName:"ul"},"To find cachelib stats, go to Scuba and search for cachelib_admin, click the table you need and filter by cache name",(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/intern/scuba/query/?pool=uber&dataset=cachelib_admin_ac_stats"},"cachelib_admin_ac_stats"),": Allocation Class stats, usually group by allocation size."),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/intern/scuba/query/?pool=uber&dataset=cachelib_admin_pool_stats"},"cachelib_admin_pool_stats"),": Pool stats, group by pool id to see each pool\u2019s stats"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/intern/scuba/query/?pool=uber&dataset=cachelib_admin_items_stats"},"cachelib_admin_items_stats"),": Items stats."))),(0,i.mdx)("li",{parentName:"ul"},"logs (",(0,i.mdx)("inlineCode",{parentName:"li"},"LOG")," / ",(0,i.mdx)("inlineCode",{parentName:"li"},"XLOG"),") are in tuppleware page, click a task and find \u201cTask Logs\u201d tab. Or ",(0,i.mdx)("inlineCode",{parentName:"li"},"/twlogs/stderr")," on the host."),(0,i.mdx)("li",{parentName:"ul"},"GDB tips:",(0,i.mdx)("ul",{parentName:"li"},(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"info local")," to print local variables"),(0,i.mdx)("li",{parentName:"ul"},(0,i.mdx)("inlineCode",{parentName:"li"},"fbload stl")," to pretty print variables, also has folly and other package (use tab after fbload to get whole list)"))),(0,i.mdx)("li",{parentName:"ul"},"Get coredump remotely: ",(0,i.mdx)("a",{parentName:"li",href:"https://www.internalfb.com/intern/wiki/Coredumper/User_Guide/Remote_Coredumps/"},"https://www.internalfb.com/intern/wiki/Coredumper/User_Guide/Remote_Coredumps/"),"\nSome coredump is unloaded to Manifold, so you don\u2019t have to login the host.")),(0,i.mdx)("h2",{id:"cachelib-knowledge"},"CacheLib Knowledge"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"https://www.internalfb.com/intern/staticdocs/cachelib/docs/Cache_Library_Architecture_Guide/overview_a_random_walk"},"Overview")),(0,i.mdx)("p",null,"CacheLib tech talk: ",(0,i.mdx)("a",{parentName:"p",href:"https://fburl.com/9lrtnmjp"},"https://fburl.com/9lrtnmjp")),(0,i.mdx)("p",null,"Some terms:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"MMContainer: eviction queue (e.g. LRU queue/container)"),(0,i.mdx)("li",{parentName:"ul"},"MMType: eviction policy (LRU/LRU2Q/LFU)"),(0,i.mdx)("li",{parentName:"ul"},"AccessType/AccessContainer: ChainedHashTable (the only indexing type now), key to item pointer mapping."),(0,i.mdx)("li",{parentName:"ul"},"CacheTrait: A combination of AccessType and MMType ",(0,i.mdx)("a",{parentName:"li",href:"https://fburl.com/diffusion/6qfp8kkj"},"https://fburl.com/diffusion/6qfp8kkj"))),(0,i.mdx)("h2",{id:"architecture-overview"},"Architecture Overview"),(0,i.mdx)("h3",{id:"dram-regular-item"},"DRAM (REGULAR ITEM)"),(0,i.mdx)("p",null,(0,i.mdx)("img",{src:t(9711).A,width:"1148",height:"801"})),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Memory"),":"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},"CacheLib will allocate a continuous memory in the beginning, and split this memory into N 4MB slabs."),(0,i.mdx)("li",{parentName:"ol"},"Each slab will be assigned to an Allocation Class (AC) upon alloc request, and reassigned to a different AC when rebalancing. Also refer to Slab Rebalancing - How Does It Work?"),(0,i.mdx)("li",{parentName:"ol"},"Each slab can store 4MB/AC.size items continuously, first few bytes are header then data (key and value) for every item.")),(0,i.mdx)("p",null,(0,i.mdx)("strong",{parentName:"p"},"Evict"),":"),(0,i.mdx)("ol",null,(0,i.mdx)("li",{parentName:"ol"},"Item with Handle hold by user won\u2019t be evicted any way, so if all items are hold alloc will fail"),(0,i.mdx)("li",{parentName:"ol"},"Every AC in a pool keeps a LRU (or other evict policy) queue."),(0,i.mdx)("li",{parentName:"ol"},"New item may evict item in slabs with same AC."),(0,i.mdx)("li",{parentName:"ol"},"Pool rebalancer will evict items in an AC to release a slab for other ACs use.")),(0,i.mdx)("h3",{id:"nvm-bighash"},"NVM (BIGHASH)"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"https://fb.quip.com/wTs6A7UMHnwY"},"BigHash Design")),(0,i.mdx)("h3",{id:"nvm-blockcache"},"NVM (BLOCKCACHE)"),(0,i.mdx)("p",null,(0,i.mdx)("a",{parentName:"p",href:"https://fb.quip.com/nHPsAsvdSHvo"},"Navy 1.5")))}h.isMDXComponent=!0},35220:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cachelib_onboarding_guide_1-1d82f40dee8f076218029708c6f4e88d.png"},9711:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cachelib_onboarding_guide_2-3ace36941152ddaf7bce3d62bc29bce2.png"}}]);